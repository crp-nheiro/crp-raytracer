CodeMirror.defineMode("tr",function(){return{startState:function(){return{column:0,inBrackets:!1,isKey:!0}},token:function(a,b){if(a.eatSpace(),a.eol())return void(b.isKey=!0);var c=a.next();return"#"===c?(a.skipToEnd(),"comment"):"{"===c||"}"===c?(b.inBrackets="{"===c,"bracket"):b.inBrackets?b.isKey?(a.eatWhile(/[^\s\{}#]/),b.isKey=a.eol(),"key"):(b.isKey=!0,a.eatWhile(/[^#]/),"value"):(a.eatWhile(/[^\s\{}#]/),"name")}}}),CodeMirror.defineMIME("text/x-diff","diff"),function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){"use strict";function b(a,b,c,e,f,g){function h(){var a=Date.now();l=a-q,window.requestAnimationFrame(h),l>1e3/f.fps&&(q=a-l%1e3/f.fps,j.putImageData(k[p],0,0),p=(p+1)%f.frames)}var i=$(c).get(0),j=i.getContext("2d"),k=[];i.width=i.width;var l,m=0,n=0,o=0,p=0,q=Date.now();d&&d.terminate(),d=new Worker("scripts/worker/tracerWorker_out.js"),d.onerror=function(a){console.error(a.message+" ("+a.filename+":"+a.lineno+")")},d.onmessage=function(a){if("result"===a.data[0]){var b,c=a.data[1],d=0;b=c.animation?c.animation.frame:0;for(var l=c.begin_y;l<c.end_y;l++)for(var p=c.begin_x;p<c.end_x;p++){var q=4*(p*i.width+l);k[b].data[q]=c.data[d++],k[b].data[q+1]=c.data[d++],k[b].data[q+2]=c.data[d++],k[b].data[q+3]=255}c.animation||j.putImageData(k[0],0,0),o++,g&&g(o/n,f.frames)}else if("resize"===a.data[0]){if(i.width=a.data[1],i.height=a.data[2],n=a.data[3],0==m)if(f){for(var d=0;d<f.frames;d++)k[d]=j.createImageData(i.width,i.height);window.requestAnimationFrame(h)}else k[0]=j.getImageData(0,0,i.width,i.height)}else"end"===a.data[0]?null!=e&&e():"error"===a.data[0]&&console.log("Error:"+a.data[1])},d.postMessage(["process",{tasks:b,input:a,animation:f}])}function c(a,b,c,d){function f(){var a=Date.now();j=a-m,window.requestAnimationFrame(f),j>1e3/c.fps&&(m=a-j%1e3/c.fps,h.putImageData(i[l],0,0),l=(l+1)%c.frames)}var g=$("#canvas-local").get(0),h=g.getContext("2d"),i=[];g.width=g.width;var j,k=0,l=0,m=Date.now();e&&e.terminate(),e=new Worker("scripts/worker/worker.js"),e.onmessage=function(j){if("result"===j.data[0]){for(var l=j.data[1],m=2,n=0;n<g.width;n++){var o=4*(l*g.width+n);i[k].data[o++]=j.data[m++],i[k].data[o++]=j.data[m++],i[k].data[o++]=j.data[m++],i[k].data[o++]=255}h.putImageData(i[k],0,0)}else if("resize"===j.data[0]){if(g.width=j.data[1].W,g.height=j.data[1].H,0==k)if(c)for(var p=0;p<c.frames;p++)i[p]=h.createImageData(g.width,g.height);else i[0]=h.getImageData(0,0,g.width,g.height)}else"end"===j.data[0]&&(k++,k<c.frames?(e.postMessage(["process",{input:a,animation:{frame:k,frames:c.frames}}]),d&&d(k,c.frames)):(window.requestAnimationFrame(f),null!=b&&b()))},e.postMessage(["process",{input:a,animation:{frame:k,frames:c.frames}}])}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var d,e,f,g=(a("crp-raytracer"),8);$(function(){f=CodeMirror.fromTextArea($("#input")[0],{lineNumbers:!0}),$("#number").val(Math.pow(g,2)),$("#slider").slider({range:"min",value:g,min:1,max:15,step:1,slide:function(a,b){g=b.value,$("#number").val(Math.pow(g,2))}}),$("#selection img:first-child").trigger("click")});var h,i,j=0,k=0,l=0,m=0,n=function(){clearInterval(h)},o=function(){clearInterval(i)},p=function(a){k=a},q=function(a){m=a};$("#run").click(function(){n(),o();var a="#####################\n# Global parameters #\n#####################\nglobal\n{\n  width		555\n  height	350\n  distscreen	1000\n  highdef	1\n}\n\n\n##########\n# Camera #\n##########\n\neye\n{\n  coords	-400 0 0\n}\n\n\n#########\n# Floor #\n#########\n\nitem\n{\n  type		plane\n  color		FFFFFF\n  reflect	20\n  checkerboard	30\n  coords	0 0 -25\n}\n\n\n##########\n# Lights #\n##########\n\nlight\n{\n  color		FFFFFF\n  intensity	100\n  coords	-300 100 100\n}\n\n\n################\n# The Pokeball #\n################\n\n### Top ###\n\nitem\n{\n  type		sphere\n  color		FF0000\n  radius	25\n  limits	0 0 0 0 2 25\n  coords	0 0 0\n  reflect	20\n  group_id	1\n}\n\n### Separator ###\n\nitem\n{\n  type		sphere\n  color		000000\n  radius	25\n  coords	0 0 0\n  limits	0 0 0 0 -2 2\n  group_id	1\n}\n\n###  Button ###\n\nitem\n{\n  type		sphere\n  color		000000\n  radius	7\n  coords	-20 0 0\n  reflect	10\n  group_id	1\n}\n\nitem\n{\n  type		sphere\n  color		FFFFFF\n  radius	4\n  coords	-24 0 0\n  reflect	10\n  group_id	1\n}\n\n### Bottom ###\n\nitem\n{\n  type		sphere\n  color		FFFFFF\n  radius	25\n  coords	0 0 0\n  limits	0 0 0 0 -25 -2\n  group_id	1\n  reflect	20\n}\n\n\n######################################\n# All the pokeballs are belong to us #\n######################################\n\ngroup\n{\n  id		1\n  rot		0 -20 0\n  coords	-30 -10 0\n}\n\ngroup\n{\n  id		1\n  coords	15 50 0\n  rot		-25 -45 30\n}\n\ngroup\n{\n  id		1\n  coords	35 -80 0\n  rot		15 30 -20\n}";j=0,h=setInterval(function(){j++,$("#time-tracer").html(j+"s"),$("#frames-tracer").html(k.toFixed(2)+" frames"),$("#fps-tracer").html(0==j?"0 fps":(k/j).toFixed(2)+" fps")},1e3),l=0,i=setInterval(function(){l++,$("#time-local").html(l+"s"),$("#frames-local").html(m+" frames"),$("#fps-local").html(0==l?"0 fps":(m/l).toFixed(2)+" fps")},1e3);var d={fps:50,frames:100};try{b(a,6,"#canvas-tracer",n,d,p),c(a,o,d,q)}catch(e){console.log(e),n(),o()}}),$("#selection img").click(function(){var a=$(this).attr("title");$.get("examples/"+a+".rt",function(a){f.setValue(a.trim())})}),$("#run-try").click(function(){$("#run-try").attr("disabled",!0),$("#save").attr("disabled",!0);var a=0,c=setInterval(function(){a++,$("#time-try").html(a+"s")},1e3),d=function(){clearInterval(c),$("#run-try").attr("disabled",!1),$("#save").attr("disabled",!1)};try{b(f.getValue(),g,"#canvas-try",d)}catch(e){console.log(e),d()}}),$("#save").click(function(){window.open($("#canvas-try").get(0).toDataURL("image/png"))})},{"crp-raytracer":3}],2:[function(a,b){function c(a,b,c,d,e,f){function g(b,c){var d=JSON.stringify({program:b}),e=new XMLHttpRequest;e.open("POST","https://api.crowdprocess.com/jobs",!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization","Token "+a),e.onreadystatechange=function(){if(4==e.readyState&&201==e.status){var a=JSON.parse(e.responseText);c&&c(a.id)}},e.onerror=function(a){console.error(e.statusText),f&&f(a)},e.send(d)}function h(b){var d=c.map(JSON.stringify).join("\n"),e=new XMLHttpRequest;e.open("POST","https://api.crowdprocess.com/jobs/"+b+"/tasks",!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization","Token "+a),e.onerror=function(a){console.error(e.statusText),f&&f(a)},e.send(d)}function i(b){var c=new XMLHttpRequest;c.open("GET","https://api.crowdprocess.com/jobs/"+b+"/errors?stream=true"),c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("Authorization","Token "+a),c.seenBytes=0,c.onreadystatechange=function(){if(c.readyState>2){var a=c.responseText.substr(c.seenBytes),b=a.lastIndexOf("\n")+1;if(b>0){var d=a.substring(0,b).split(/\r?\n/);d.pop(),d.map(function(a){f(JSON.parse(a))}),c.seenBytes+=b}}},c.send()}function j(b,c){var f=new XMLHttpRequest;f.open("GET","https://api.crowdprocess.com/jobs/"+b+"/results?stream=true"),f.setRequestHeader("Authorization","Token "+a),f.seenBytes=0,f.onreadystatechange=function(){if(f.readyState>2){var a=f.responseText.substr(f.seenBytes),b=a.lastIndexOf("\n")+1;if(b>0){var g=a.substring(0,b).split(/\r?\n/);g.pop(),g.map(function(a){d(JSON.parse(a)),c--}),f.seenBytes+=b}}0==c&&(f.abort(),e&&e())},f.send(null)}g(b,function(a){i(a,f),j(a,c.length,d),h(a)})}b.exports=c},{}],3:[function(a,b){"use strict";function c(a){function b(a){var b=m[a.id];h.emit("data",{begin_x:b.begin_x,end_x:b.end_x,begin_y:b.begin_y,end_y:b.end_y,animation:a.animation,data:a.data})}function c(){h.emit("end",{width:k.global.width,height:k.global.height})}function g(a){h.emit("error",a)}if(d.EventEmitter.call(this),void 0==a.input)throw"Invalid input";if(!a.mock&&void 0==a.credentials)throw"Invalid credentials";var h=this,i=a.split||10,j=(a.mock||!1,a.animation||!1),k=new e(a.input).parse(),l="var scene, textures_remaining,\n__slice = [].slice;\n\nvar self = {};\n\nfunction copy(obj) {\n  if(Array.isArray(obj)) {\n    return obj.slice();\n  } else if (obj instanceof Object && !(obj instanceof Function)) {\n    var new_obj = {};\n    for(var key in obj) {\n      var val = obj[key];\n      new_obj[key] = copy(val);\n    }\n    return new_obj;\n  } else {\n    return obj;\n  }\n};\n\n/* glMatrix */\n\nvar cos=Math.cos, sin=Math.sin;\nvec3={\n  create:function(a){var b=new Array(3);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):b[0]=b[1]=b[2]=0;return b},\n  set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},\n  add:function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},\n  mul:function(a,b,c){if(!c||a===c)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a;c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c},\n  sub:function(a,b,c){if(!c||a===c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},\n  negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b},\n  scale:function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},\n  plus:function(a,b,c){if(!c||a===c)return a[0]+=b,a[1]+=b,a[2]+=b,a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c},\n  normalize:function(a,b){b||(b=a);var c=a[0],e=a[1],f=a[2],d=Math.sqrt(c*c+e*e+f*f);if(d){if(1===d)return b[0]=c,b[1]=e,b[2]=f,b}else return b[0]=0,b[1]=0,b[2]=0,b;d=1/d;b[0]=c*d;b[1]=e*d;b[2]=f*d;return b},\n  cross:function(a,b,c){c||(c=a);var e=a[0],f=a[1],a=a[2],d=b[0],g=b[1],b=b[2];c[0]=f*b-a*g;c[1]=a*d-e*b;c[2]=e*g-f*d;return c},\n  dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},\n  str:function (a) {return '['+a[0]+', '+a[1]+', '+a[2]+']'},\n  length:function (vec) { var x = vec[0], y = vec[1], z = vec[2]; return Math.sqrt(x * x + y * y + z * z);},\n  reflect:function(i,n,r){return vec3.sub(i,vec3.scale(n,2*vec3.dot(n,i),r),r)},\n  rotateXYZ:function(v,x,y,z){\n    var m=mat4.create(mat4.identity());\n    mat4.rotateX(m,x);\n    mat4.rotateY(m,y);\n    mat4.rotateZ(m,z);\n    return mat4.multiplyVec3(m,v);\n  },\n  mix:function(x,y,a){\n    return vec3.add(\n      vec3.scale(x,1-a,vec3.create()),\n      vec3.scale(y,a,vec3.create()),\n      vec3.create());\n  }\n}\nmat4={\n  create:function(a){var b=new Array(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b},\n  identity:function(a){a||(a=mat4.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},\n  multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],e=b[1],b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14];return c},\n  multiplyDelta3: function(mat, vec) {\n    var a_ = mat4.multiplyVec3(mat, [0, 0, 0]);\n    var b_ = mat4.multiplyVec3(mat, vec3.create(vec));\n    return vec3.sub(b_, a_);\n  },\n  rotateX:function(b,c,a){var d=Math.sin(c),c=Math.cos(c),e=b[4],f=b[5],g=b[6],h=b[7],i=b[8],j=b[9],k=b[10],l=b[11];a?b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]):a=b;a[4]=e*c+i*d;a[5]=f*c+j*d;a[6]=g*c+k*d;a[7]=h*c+l*d;a[8]=e*-d+i*c;a[9]=f*-d+j*c;a[10]=g*-d+k*c;a[11]=h*-d+l*c;return a},\n  rotateY:function(b,c,a){var d=Math.sin(c),c=Math.cos(c),e=b[0],f=b[1],g=b[2],h=b[3],i=b[8],j=b[9],k=b[10],l=b[11];a?b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]):a=b;a[0]=e*c+i*-d;a[1]=f*c+j*-d;a[2]=g*c+k*-d;a[3]=h*c+l*-d;a[8]=e*d+i*c;a[9]=f*d+j*c;a[10]=g*d+k*c;a[11]=h*d+l*c;return a},\n  rotateZ:function(b,c,a){var d=Math.sin(c),c=Math.cos(c),e=b[0],f=b[1],g=b[2],h=b[3],i=b[4],j=b[5],k=b[6],l=b[7];a?b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]):a=b;a[0]=e*c+i*d;a[1]=f*c+j*d;a[2]=g*c+k*d;a[3]=h*c+l*d;a[4]=e*-d+i*c;a[5]=f*-d+j*c;a[6]=g*-d+k*c;a[7]=h*-d+l*c;return a},\n  translate:function(a,c,b){var d=c[0],e=c[1],c=c[2],f,g,h,i,j,k,l,m,n,o,p,q;if(!b||a===b)return a[12]=a[0]*d+a[4]*e+a[8]*c+a[12],a[13]=a[1]*d+a[5]*e+a[9]*c+a[13],a[14]=a[2]*d+a[6]*e+a[10]*c+a[14],a[15]=a[3]*d+a[7]*e+a[11]*c+a[15],a;f=a[0];g=a[1];h=a[2];i=a[3];j=a[4];k=a[5];l=a[6];m=a[7];n=a[8];o=a[9];p=a[10];q=a[11];b[0]=f;b[1]=g;b[2]=h;b[3]=i;b[4]=j;b[5]=k;b[6]=l;b[7]=m;b[8]=n;b[9]=o;b[10]=p;b[11]=q;b[12]=f*d+j*e+n*c+a[12];b[13]=g*d+k*e+o*c+a[13];b[14]=h*d+l*e+p*c+a[14];b[15]=i*d+m*e+q*c+a[15];return b},\n  scale:function(a,c,b){var d=c[0],e=c[1],c=c[2];if(!b||a===b)return a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=c,a[9]*=c,a[10]*=c,a[11]*=c,a;b[0]=a[0]*d;b[1]=a[1]*d;b[2]=a[2]*d;b[3]=a[3]*d;b[4]=a[4]*e;b[5]=a[5]*e;b[6]=a[6]*e;b[7]=a[7]*e;b[8]=a[8]*c;b[9]=a[9]*c;b[10]=a[10]*c;b[11]=a[11]*c;b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},\n  inverse:function(c,a){a||(a=c);var d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=c[9],n=c[10],o=c[11],p=c[12],q=c[13],r=c[14],s=c[15],t=d*i-e*h,u=d*j-f*h,v=d*k-g*h,w=e*j-f*i,x=e*k-g*i,y=f*k-g*j,z=l*q-m*p,A=l*r-n*p,B=l*s-o*p,C=m*r-n*q,D=m*s-o*q,E=n*s-o*r,b=t*E-u*D+v*C+w*B-x*A+y*z;if(!b)return null;b=1/b;a[0]=(i*E-j*D+k*C)*b;a[1]=(-e*E+f*D-g*C)*b;a[2]=(q*y-r*x+s*w)*b;a[3]=(-m*y+n*x-o*w)*b;a[4]=(-h*E+j*B-k*A)*b;a[5]=(d*E-f*B+g*A)*b;a[6]=(-p*y+r*v-s*u)*b;a[7]=(l*y-n*v+o*u)*b;a[8]=(h*D-i*B+k*z)*b;a[9]=(-d*D+e*B-g*z)*b;a[10]=(p*x-q*v+s*t)*b;a[11]=(-l*x+m*v-o*t)*b;a[12]=(-h*C+i*A-j*z)*b;a[13]=(d*C-e*A+f*z)*b;a[14]=(-p*w+q*u-r*t)*b;a[15]=(l*w-m*u+n*t)*b;return a},\n  multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=a[9],n=a[10],o=a[11],p=a[12],q=a[13],r=a[14],a=a[15],s=b[0],t=b[1],u=b[2],v=b[3],w=b[4],x=b[5],y=b[6],z=b[7],A=b[8],B=b[9],C=b[10],D=b[11],E=b[12],F=b[13],G=b[14],b=b[15];c[0]=s*d+t*h+u*l+v*p;c[1]=s*e+t*i+u*m+v*q;c[2]=s*f+t*j+u*n+v*r;c[3]=s*g+t*k+u*o+v*a;c[4]=w*d+x*h+y*l+z*p;c[5]=w*e+x*i+y*m+z*q;c[6]=w*f+x*j+y*n+z*r;c[7]=w*g+x*k+y*o+z*a;c[8]=A*d+B*h+C*l+D*p;c[9]=A*e+B*i+C*m+D*q;c[10]=A*f+B*j+C*n+D*r;c[11]=A*g+B*k+C*o+D*a;c[12]=E*d+F*h+G*l+b*p;c[13]=E*e+F*i+G*m+b*q;c[14]=E*f+F*j+G*n+b*r;c[15]=E*g+F*k+G*o+b*a;return c}\n}\n\n/* ray.js */\n\nvar inLimits, intersect, intersectItem, isValid, launchRay, lightning, mod, objects, processPixel, sign, solve_eq2,\n__slice = [].slice;\n\nvar epsilon = 0.0001;\n\nfunction mod(x, n) {\n  return ((x % n) + n) % n;\n}\n\nfunction sign(x) {\n  if (x > 0) {\n    return 1;\n  } else if (x === 0) {\n    return 0;\n  } else {\n    return -1;\n  }\n}\n\nfunction solve_eq2(a, b, c) {\n  var delta = b * b - 4 * a * c;\n  if (delta < 0) {\n    return [];\n  }\n  var sqDelta = Math.sqrt(delta);\n  return [(-b - sqDelta) / (2 * a), (-b + sqDelta) / (2 * a)];\n}\n\n/*\n * Objects\n */\n\nobjects = {};\n\nobjects.plane = {\n  solutions: function(item, ray_) {\n    if (ray_.dir[2] !== 0) {\n      return [-ray_.origin[2] / ray_.dir[2]];\n    } else {\n      return [];\n    }\n  },\n  pos2d: function(item, pos_, width, height) {\n    return [width / 2 - pos_[1], height / 2 - pos_[0]];\n  },\n  normal: function(item, ray_, pos_) {\n    return [0, 0, -sign(ray_.dir[2])];\n  }\n};\n\nobjects.sphere = {\n  solutions: function(item, ray_) {\n    var a, b, c;\n    a = vec3.dot(ray_.dir, ray_.dir);\n    b = 2 * vec3.dot(ray_.origin, ray_.dir);\n    c = (vec3.dot(ray_.origin, ray_.origin)) - item.radius2;\n    return solve_eq2(a, b, c);\n  },\n  pos2d: function(item, pos_, width, height) {\n    var phi, theta, x, y;\n    pos_ = vec3.normalize(pos_, vec3.create());\n    phi = Math.acos(pos_[2]);\n    y = phi / Math.PI * height;\n    theta = Math.acos(pos_[1] / Math.sin(phi)) / (2 * Math.PI);\n    if (pos_[0] > 0) {\n      theta = 1 - theta;\n    }\n    x = theta * width;\n    return [x, y];\n  },\n  normal: function(item, ray_, pos_) {\n    return pos_;\n  }\n};\n\nobjects.cone = {\n  solutions: function(item, ray_) {\n    var a, b, c;\n    a = ray_.dir[0] * ray_.dir[0] + ray_.dir[1] * ray_.dir[1] - item.radius * ray_.dir[2] * ray_.dir[2];\n    b = 2 * (ray_.origin[0] * ray_.dir[0] + ray_.origin[1] * ray_.dir[1] - item.radius * ray_.origin[2] * ray_.dir[2]);\n    c = ray_.origin[0] * ray_.origin[0] + ray_.origin[1] * ray_.origin[1] - item.radius * ray_.origin[2] * ray_.origin[2];\n    return solve_eq2(a, b, c);\n  },\n  pos2d: objects.sphere.pos2d,\n  normal: function(item, ray_, pos_) {\n    var normal;\n    normal = vec3.create(pos_);\n    normal[2] = -normal[2] * Math.tan(item.radius2);\n    return normal;\n  }\n};\n\nobjects.cylinder = {\n  solutions: function(item, ray_) {\n    var a, b, c;\n    a = ray_.dir[0] * ray_.dir[0] + ray_.dir[1] * ray_.dir[1];\n    b = 2 * (ray_.origin[0] * ray_.dir[0] + ray_.origin[1] * ray_.dir[1]);\n    c = ray_.origin[0] * ray_.origin[0] + ray_.origin[1] * ray_.origin[1] - item.radius2;\n    return solve_eq2(a, b, c);\n  },\n  pos2d: objects.sphere.pos2d,\n  normal: function(item, ray_, pos_) {\n    var normal;\n    normal = vec3.create(pos_);\n    normal[2] = 0;\n    return normal;\n  }\n};\n\nobjects.portal = copy(objects.plane);\n\nobjects.portal.normal = function(item, ray_, pos_) {\n  return [0, 0, 1];\n};\n\nfunction inLimits(limits, pos_) {\n  var _ref, _ref1, _ref2;\n  return (limits[0] <= (_ref = pos_[0]) && _ref <= limits[1]) && (limits[2] <= (_ref1 = pos_[1]) && _ref1 <= limits[3]) && (limits[4] <= (_ref2 = pos_[2]) && _ref2 <= limits[5]);\n};\n\nfunction isValid(ray, distances, item, min_distance) {\n  var distance, pos, pos_, _i, _len;\n  for (_i = 0, _len = distances.length; _i < _len; _i++) {\n    distance = distances[_i];\n    if (!((0 < distance && distance < min_distance))) {\n      continue;\n    }\n    pos = vec3.create();\n    pos = vec3.add(ray.origin, vec3.scale(ray.dir, distance, pos), pos);\n    pos_ = mat4.multiplyVec3(item.inverse, pos, vec3.create());\n    if (inLimits(item.limits, pos_)) {\n      return [pos, pos_, distance];\n    }\n  }\n  return [null, null, null, null];\n};\n\nfunction intersectItem(item, ray, min_distance) {\n  var ray_ = {\n    dir: vec3.normalize(mat4.multiplyDelta3(item.inverse, ray.dir)),\n    origin: mat4.multiplyVec3(item.inverse, ray.origin, [0, 0, 0])\n  };\n  var obj = objects[item.type];\n\n  var _ref = isValid(ray, obj.solutions(item, ray_), item, min_distance);\n  var pos = _ref[0];\n  var pos_ = _ref[1];\n  var distance = _ref[2];\n  if(!pos) {\n    return;\n  }\n  var color = item.color;\n  var opacity = item.opacity;\n  var reflect = item.reflect;\n  var dir = ray.dir;\n  if(item.tex != null) {\n    var texture = textures[item.tex];\n    var pos2d = obj.pos2d(item, pos_, texture.width, texture.height);\n    var x = Math.floor(pos2d[0]);\n    var y = Math.floor(pos2d[1]);\n    if(item.tex_rep !== 0) {\n      x = mod(x * item.tex_coef, texture.width);\n      y = mod(y * item.tex_coef, texture.height);\n    }\n    var idx = (texture.width * y + x) * 4;\n    opacity *= texture.data[idx + 3] / 255;\n    color = [texture.data[idx] / 255, texture.data[idx + 1] / 255, texture.data[idx + 2] / 255];\n  }\n  if(item.checkerboard != null) {\n    var pos2d = obj.pos2d(item, pos_, 500, 500);\n    if((mod(pos2d[0] / item.checkerboard, 1) > 0.5) === (mod(pos2d[1] / item.checkerboard, 1) > 0.5)) {\n      color = item.color2;\n    }\n  }\n  if(item.pnoise > 0) {\n    var alpha = perlin(pos_, item.pnoise, item.pnoise_pers, item.pnoise_octave, item.pnoise_freq);\n    color = vec3.mix(color, item.color2, alpha);\n  }\n  if(item.type === 'portal') {\n    var dist = item.radius2 - (pos_[0] * pos_[0] + 2 * pos_[1] * pos_[1]);\n    if(dist < 0) {\n      return;\n    }\n    opacity *= 1 - Math.exp(-dist / 2000);\n    opacity = 1 - opacity;\n    pos = mat4.multiplyVec3(item.other.transform, pos_, vec3.create());\n    dir = vec3.normalize(mat4.multiplyDelta3(item.other.transform, vec3.create(ray_.dir)));\n  }\n  var normal = obj.normal(item, ray_, pos_);\n  normal = vec3.normalize(mat4.multiplyDelta3(item.transform, vec3.create(normal)));\n  if(opacity === 0) {\n    return;\n  }\n  return {\n    distance: distance,\n    pos: pos,\n    normal: normal,\n    color: color,\n    item: item,\n    opacity: opacity,\n    reflect: reflect,\n    dir: dir\n  };\n};\n\nfunction intersect(ray, min_distance) {\n  if(min_distance == null) {\n    min_distance = Infinity;\n  }\n  var min_isect = null;\n  for(i = 0; i < self.scene.item.length; i++) {\n    var item = self.scene.item[i];\n    var isect = intersectItem(item, ray, min_distance);\n    if(isect && (!min_isect || isect.distance < min_isect.distance)) {\n      min_isect = isect;\n      min_distance = isect.distance;\n    }\n  }\n  return min_isect;\n};\n\nfunction lightning(isect) {\n  var color;\n  if(self.scene.light != null) {\n    color = [0, 0, 0];\n  } else {\n    color = vec3.create(isect.color);\n  }\n  for(var i = 0; i < self.scene.light.length; i++) {\n    var light = self.scene.light[i];\n    var dir = vec3.sub(light.coords, isect.pos, vec3.create());\n    var min_distance = vec3.length(dir);\n    vec3.normalize(dir);\n    var pos = vec3.create();\n    pos = vec3.add(isect.pos, vec3.scale(dir, epsilon, pos), pos);\n    var ray = {\n      origin: vec3.create(pos),\n      dir: vec3.create(dir)\n    };\n    if(!intersect(ray, min_distance)) {\n      var shade = Math.abs(vec3.dot(isect.normal, ray.dir));\n      var add_color = vec3.create(isect.color);\n      add_color = vec3.plus(add_color, isect.item.brightness);\n      add_color = vec3.mul(add_color, light.color);\n      vec3.scale(add_color, shade);\n      add_color = vec3.scale(add_color, isect.item.intensity);\n      vec3.add(color, add_color);\n    }\n  }\n  var ambiant = vec3.create(isect.color);\n  vec3.mul(ambiant, self.scene.global.l_color);\n  vec3.add(color, ambiant);\n  return color;\n};\n\nfunction launchRay(ray, count) {\n  var color = [0, 0, 0];\n  var isect = intersect(ray);\n  if(isect) {\n    color = lightning(isect);\n    if(count > 0 && isect.opacity < 1) {\n      var ray2 = {\n        origin: vec3.add(isect.pos, vec3.scale(isect.dir, epsilon, vec3.create()), vec3.create()),\n        dir: vec3.normalize(vec3.create(isect.dir))\n      };\n      color = vec3.mix(color, launchRay(ray2, count - 1), 1 - isect.opacity);\n    }\n    if(count > 0 && isect.reflect > 0) {\n      var ray2 = {\n        origin: vec3.add(isect.pos, vec3.scale(isect.normal, epsilon, vec3.create()), vec3.create()),\n        dir: vec3.normalize(vec3.reflect(ray.dir, vec3.normalize(isect.normal), vec3.create()))\n      };\n      color = vec3.mix(color, launchRay(ray2, count - 1), isect.reflect);\n    }\n  }\n  return color;\n};\n\nfunction processPixel(x, y) {\n  var ray = {\n    origin: vec3.create(self.scene.eye.coords),\n    dir: vec3.normalize([self.scene.global.distscreen, x, y])\n  };\n  ray.dir = vec3.normalize(vec3.rotateXYZ.apply(vec3, [ray.dir].concat(__slice.call(self.scene.eye.rot))));\n  return launchRay(ray, self.scene.global.max_reflect);\n};\n\nfunction process(x, y, upscale, randomRays) {\n  var color = [0, 0, 0];\n  vec3.add(color, processPixel((self.scene.global.W / 2 - x) / upscale, (self.scene.global.H / 2 - y) / upscale));\n  for(var i = 0; i < randomRays; i++) {\n    vec3.add(color, processPixel((self.scene.global.W / 2 - x + Math.random() - 0.5) / upscale, (self.scene.global.H / 2 - y + Math.random() - 0.5) / upscale));\n  }\n  return vec3.scale(color, 1 / (1 + randomRays));\n};\n\n/* perlin.js */\n\nvar perlin;\n\n// Generated by CoffeeScript 1.7.1\n(function() {\n  \n  // http://asserttrue.blogspot.com/2011/12/perlin-noise-in-javascript_31.html\n  // This is a port of Ken Perlin's Java code. The\n  // original Java code is at http://cs.nyu.edu/%7Eperlin/noise/.\n  // Note that in this version, a number from 0 to 1 is returned.\n  PerlinNoise = new function() {\n\n    this.noise = function noise(x, y, z) {\n\n       var p = new Array(512)\n       var permutation = [ 151,160,137,91,90,15,\n       131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\n       190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\n       88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\n       77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\n       102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\n       135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\n       5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\n       223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\n       129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\n       251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\n       49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\n       138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\n       for (var i=0; i < 256 ; i++)\n        p[256+i] = p[i] = permutation[i];\n\n        var X = Math.floor(x) & 255,                  // FIND UNIT CUBE THAT\n              Y = Math.floor(y) & 255,                  // CONTAINS POINT.\n              Z = Math.floor(z) & 255;\n          x -= Math.floor(x);                                // FIND RELATIVE X,Y,Z\n          y -= Math.floor(y);                                // OF POINT IN CUBE.\n          z -= Math.floor(z);\n          var    u = fade(x),                                // COMPUTE FADE CURVES\n                 v = fade(y),                                // FOR EACH OF X,Y,Z.\n                 w = fade(z);\n          var A = p[X  ]+Y, AA = p[A]+Z, AB = p[A+1]+Z,      // HASH COORDINATES OF\n              B = p[X+1]+Y, BA = p[B]+Z, BB = p[B+1]+Z;      // THE 8 CUBE CORNERS,\n\n          return scale(lerp(w, lerp(v, lerp(u, grad(p[AA  ], x  , y  , z   ),  // AND ADD\n                                         grad(p[BA  ], x-1, y  , z   )), // BLENDED\n                                 lerp(u, grad(p[AB  ], x  , y-1, z   ),  // RESULTS\n                                         grad(p[BB  ], x-1, y-1, z   ))),// FROM  8\n                         lerp(v, lerp(u, grad(p[AA+1], x  , y  , z-1 ),  // CORNERS\n                                         grad(p[BA+1], x-1, y  , z-1 )), // OF CUBE\n                                 lerp(u, grad(p[AB+1], x  , y-1, z-1 ),\n                                         grad(p[BB+1], x-1, y-1, z-1 )))));\n    }\n    \n    function fade(t) { return t * t * t * (t * (t * 6 - 15) + 10); }\n    function lerp( t, a, b) { return a + t * (b - a); }\n    function grad(hash, x, y, z) {\n      var h = hash & 15; /* CONVERT LO 4 BITS OF HASH CODE */\n      var u = h<8 ? x : y, /* INTO 12 GRADIENT DIRECTIONS. */\n      v = h<4 ? y : h==12||h==14 ? x : z;\n      return ((h&1) == 0 ? u : -u) + ((h&2) == 0 ? v : -v);\n    }\n    function scale(n) { return n; /*return (1 + n)/2;*/ }\n  };\n  \n  var clamp = function clamp(x, min, max) {\n    if (x < min) {\n      return min;\n    }\n    if (x > max) {\n      return max;\n    }\n    return x;\n  };\n\n  perlin = function perlin(pos, id, persistence, octaves, frequence) {\n    var amplitude, frequency, i, noise, _i;\n    pos = vec3.scale(pos, frequence, vec3.create());\n    noise = 0;\n    frequency = 1;\n    amplitude = 1;\n    for (i = _i = 0; 0 <= octaves ? _i < octaves : _i > octaves; i = 0 <= octaves ? ++_i : --_i) {\n      noise += amplitude * PerlinNoise.noise(pos[0] * frequency, pos[1] * frequency, pos[2] * frequency);\n      frequency *= 2;\n      amplitude *= persistence;\n    }\n    if (id === 2) {\n      noise *= 20;\n      noise = noise - Math.floor(noise);\n    }\n    if (id === 3) {\n      noise = Math.cos(noise);\n    }\n    return (clamp(noise, -1, 1) + 1) / 2;\n  };\n\n}).call(this);\n\n/* worker.js */\n\nscene = null;\nself.textures = {};\n\nfunction render(scene, animation) {\n  self.scene = scene;\n\n  if(scene.global.highdef == null) {\n    scene.global.highdef = [];\n  }\n  if(scene.global.highdef[0] == null) {\n    scene.global.highdef[0] = 1;\n  }\n  if(scene.global.highdef[1] == null) {\n    scene.global.highdef[1] = 0;\n  }\n\n  scene.global.upscale = scene.global.highdef[0];\n  scene.global.randomRays = scene.global.highdef[1];\n\n  if(scene.global.distscreen == null) {\n    scene.global.distscreen = 1000;\n  }\n  if(scene.global.max_reflect == null) {\n    scene.global.max_reflect = 10;\n  }\n  if(scene.global.l_color == null) {\n    scene.global.l_color = [0, 0, 0];\n  }\n\n  scene.global.l_intensity = (scene.global.l_intensity != null ? scene.global.l_intensity : 0) / 100;\n  vec3.scale(scene.global.l_color, scene.global.l_intensity);\n\n  if(animation) {\n    var theta = (2 * Math.PI * animation.frame) / animation.frames;\n    scene.eye.coords = [400 * Math.cos(-(Math.PI - theta)), 400 * Math.sin(-(Math.PI - theta)), 0];\n    scene.eye.rot = [0, 0, theta];\n  } else {\n    scene.eye.rot = vec3.scale(scene.eye.rot != null ? scene.eye.rot : [0, 0, 0], Math.PI / 180);\n  }\n\n  scene.global.W = scene.global.width * scene.global.upscale;\n  scene.global.H = scene.global.height * scene.global.upscale;\n  \n  var groups = {};\n  var portals = {};\n\n  if(scene.light == null) {\n    scene.light = [];\n  }\n  for(var i = 0; i < scene.light.length; i++) {\n    var light = scene.light[i];\n    if(light.coords == null) {\n      light.coords = [0, 0, 0];\n    }\n    if(light.color == null) {\n      light.color = [1, 1, 1];\n    }\n  }\n  /* Items */\n  for(var i = 0; i < scene.item.length; i++) {\n    var item = scene.item[i];\n\n    if(item.color == null) {\n      item.color = [1, 1, 1];\n    }\n    if(item.color2 == null) {\n      item.color2 = item.color.map(function(x) {\n        return 1 - x;\n      });\n    }\n    if(item.coords == null) {\n      item.coords = [0, 0, 0];\n    }\n    item.rot = vec3.scale(item.rot != null ? item.rot : [0, 0, 0], Math.PI / 180);\n    item.brightness = (item.brightness != null ? item.brightness : 0) / 100;\n    item.intensity = (item.intensity != null ? item.intensity : 100) / 100;\n    item.reflect = (item.reflect != null ? item.reflect : 0) / 100;\n    item.opacity = (item.opacity != null ? item.opacity : 100) / 100;\n    if(item.radius == null) {\n      item.radius = 2;\n    }\n    if(item.limits == null) {\n      item.limits = [0, 0, 0, 0, 0, 0];\n    }\n    for(var j = 0; j < 3; j++) {\n      if(item.limits[2 * j] >= item.limits[2 * j + 1]) {\n        item.limits[2 * j] = -Infinity;\n        item.limits[2 * j + 1] = Infinity;\n      }\n    }\n    if(item.pnoise == null) {\n      item.pnoise = 0;\n    }\n    if(item.pnoise_freq == null) {\n      item.pnoise_freq = 1;\n    }\n    if(item.pnoise_pers == null) {\n      item.pnoise_pers = 1;\n    }\n    if(item.pnoise_octave == null) {\n      item.pnoise_octave = 1;\n    }\n    item.transform = mat4.identity();\n    mat4.translate(item.transform, item.coords);\n    mat4.rotateX(item.transform, item.rot[0]);\n    mat4.rotateY(item.transform, item.rot[1]);\n    mat4.rotateZ(item.transform, item.rot[2]);\n    if(item.group_id) {\n      if(groups[item.group_id] == null) {\n        groups[item.group_id] = [];\n      }\n      groups[item.group_id].push(item);\n    }\n    if(item.portal_id != null) {\n      if (!(item.portal_id in portals)) {\n        portals[item.portal_id] = [];\n      }\n      portals[item.portal_id].push(item);\n    }\n  }\n  /* Portals */\n  for(var id in portals) {\n    portals[id][0].other = portals[id][1];\n    portals[id][1].other = portals[id][0];\n  }\n  /* Groups */\n  if(scene.group == null) {\n    scene.group = [];\n  }\n  for(var i = 0; i < scene.group.length; i++) {\n    var group = scene.group[i];\n    if(group.size_mul == null) {\n      group.size_mul = 1;\n    }\n    group.rot = vec3.scale(group.rot != null ? group.rot : [0, 0, 0], Math.PI / 180);\n    if(group.coords == null) {\n      group.coords = [0, 0, 0];\n    }\n    group.transform = mat4.identity();\n    mat4.scale(group.transform, [group.size_mul, group.size_mul, group.size_mul]);\n    mat4.translate(group.transform, group.coords);\n    mat4.rotateX(group.transform, group.rot[0]);\n    mat4.rotateY(group.transform, group.rot[1]);\n    mat4.rotateZ(group.transform, group.rot[2]);\n    if (!(group.id in groups)) {\n      continue;\n    }\n    for(var j = 0; j < groups[group.id].length; j++) {\n      var item_raw = groups[group.id][j];\n      var item = copy(item_raw);\n      delete item.group_id;\n      var t = mat4.create(group.transform);\n      mat4.multiply(t, item.transform);\n      item.transform = t;\n      scene.item.push(item);\n    }\n  }\n  scene.item = scene.item.filter(function(item) {\n    return item.group_id == null;\n  });\n\n  /* Textures */\n  for(var i = 0 ; i < scene.item.length; i++) {\n    var item = scene.item[i];\n    item.coords = mat4.multiplyVec3(item.transform, [0, 0, 0]);\n    item.inverse = mat4.inverse(item.transform, mat4.create());\n    item.radius2 = item.radius * item.radius;\n    if(item.tex != null) {\n      if(item.tex_rep == null) {\n        item.tex_rep = 0;\n      }\n      if(item.tex_coef == null) {\n        item.tex_coef = 1;\n      }\n    }\n  }\n\n  /* Render */\n  var result = []\n  for(var y = scene.job.begin_y; y < scene.job.end_y; y++) {\n    for(var x = scene.job.begin_x; x < scene.job.end_x; x++) {\n      var color = process(y, x, scene.global.upscale, scene.global.randomRays);\n      result.push(~~(color[0] * 255));\n      result.push(~~(color[1] * 255));\n      result.push(~~(color[2] * 255));\n    }\n  }\n  return result;\n}\n\n/* To run on crowdprocess */\nfunction Run(d) {\n  var scene = %%SCENE%%;\n  scene.job = d;\n  return {\n    id: d.id,\n    animation: d.animation,\n    data: render(scene, d.animation)\n  };    \n}".replace("%%SCENE%%",JSON.stringify(k)),m=[],n=Math.floor(k.global.width/i),o=Math.ceil(k.global.width/n),p=Math.floor(k.global.height/i),q=Math.ceil(k.global.height/p),r=0;
if(j)for(var s=0;s<j.frames;s++)for(var t=0;o>t;t++)for(var u=0;q>u;u++)m.push({id:r++,animation:{frame:s,frames:j.frames},begin_x:p*u,end_x:q-1>u?p*(u+1):k.global.height,begin_y:n*t,end_y:o-1>t?n*(t+1):k.global.width});else for(var t=0;o>t;t++)for(var u=0;q>u;u++)m.push({id:r++,begin_x:p*u,end_x:q-1>u?p*(u+1):k.global.height,begin_y:n*t,end_y:o-1>t?n*(t+1):k.global.width});this.run=function(){h.emit("run",{width:k.global.width,height:k.global.height,splitsPerFrame:o*q});new f(a.credentials.token,l,m,b,c,g)}}var d=a("events"),e=a("./src/parser").Parser,f=a("./crp-client.js");b.exports=c,c.prototype.__proto__=d.EventEmitter.prototype},{"./crp-client.js":2,"./src/parser":4,events:5}],4:[function(a,b){var c=[].slice;Array.prototype.contains=function(a){return-1!==this.indexOf(a)};var d=function(){function a(a){this.lines=a.replace(/\#[^\n]*/g,"").replace(/\{/g,"\n{").split("\n").map(function(a){return a.trim()}).filter(function(a){return a})}return a.prototype.objectify=function(a){var b,c,d,e,f,g;for(b={},e=0,f=a.length;f>e;e++)g=a[e],c=g[0],d=g[1],this.multiple.contains(c)?(c in b||(b[c]=[]),b[c].push(d)):b[c]=d;return b},a.prototype.multiple=["light","item","group"],a.prototype.convert=[{func:function(a){return a[0].match(/(..)/g).map(function(a){return parseInt(a,16)/255})},fields:["color","color2","l_color","tex_color_cut"]},{func:function(a){return a[0]},fields:["tex","type"]},{func:function(a){return+a[0]},fields:["radius","width","height","checkerboard","distscreen","brightness","group_id","id","max_reflect","tex_rep","tex_coef","size_mul","reflect","l_intensity","pnoise","pnoise_octave","pnoise_freq","pnoise_pers","bump","opacity","portal_id"]},{func:function(a){return a.map(function(a){return+a})},fields:["highdef","coords","limits","rot"]}],a.prototype.parse=function(){var a;return this.objectify(function(){var b;for(b=[];a=this.parseBlock();)b.push(a);return b}.call(this))},a.prototype.parseBlock=function(){var a,b,d,e,f,g;return(e=this.lines.shift())?(this.lines.shift(),f=this.objectify(function(){var e,f,h,i,j;for(j=[];(d=this.lines.shift())&&"}"!==d;){for(h=d.split(/\s+/),b=h[0],g=2<=h.length?c.call(h,1):[],i=this.convert,e=0,f=i.length;f>e;e++)a=i[e],a.fields.contains(b)&&(g=a.func(g));j.push([b,g])}return j}.call(this)),[e,f]):void 0},a}();b.exports.Parser=d},{}],5:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length))throw b=arguments[1],b instanceof Error?b:TypeError('Uncaught, unspecified "error" event.');if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}]},{},[1]);